
<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پەنجەرا ئەدمین - پڕۆژێ ئیسلام</title>
    <style>
        :root {
            --dark-bg: #0d1117; --card-bg: #161b22; --primary-text: #c9d1d9; --secondary-text: #8b949e;
            --accent-color: #58a6ff; --border-color: #30363d; --success-color: #2ea043; --danger-color: #f85149;
            --font-kurdish: 'Noto Sans Arabic', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;500;700&display=swap');
        body { font-family: var(--font-kurdish); background-color: var(--dark-bg); color: var(--primary-text); margin: 0; padding: 0; line-height: 1.6; }
        .container { max-width: 1200px; margin: 20px auto; padding: 20px; }
        /* Login Screen */
        #login-screen { display: flex; justify-content: center; align-items: center; height: 100vh; }
        #login-form { background: var(--card-bg); padding: 30px; border-radius: 10px; border: 1px solid var(--border-color); width: 100%; max-width: 400px; }
        #login-form h1 { text-align: center; margin-bottom: 20px; }
        /* Admin Panel */
        #admin-panel { display: none; }
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background: var(--card-bg); border-bottom: 1px solid var(--border-color); }
        .main-layout { display: flex; }
        nav { width: 200px; background: var(--card-bg); padding: 15px; border-left: 1px solid var(--border-color); height: calc(100vh - 70px); }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav li button { background: none; border: none; color: var(--primary-text); padding: 12px 15px; width: 100%; text-align: right; font-family: var(--font-kurdish); font-size: 1rem; cursor: pointer; border-radius: 6px; }
        nav li button:hover, nav li button.active { background-color: var(--accent-color); color: var(--dark-bg); }
        main { flex: 1; padding: 20px; height: calc(100vh - 70px); overflow-y: auto; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        /* General Styles */
        h1, h2, h3 { margin-top: 0; }
        h2 { border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; margin-bottom: 20px; }
        button { background: var(--accent-color); color: #fff; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-family: var(--font-kurdish); }
        button:hover { opacity: 0.9; }
        button.danger { background: var(--danger-color); }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input[type="text"], input[type="email"], input[type="password"], input[type="url"], input[type="number"], textarea, select {
            width: 100%; background: var(--dark-bg); border: 1px solid var(--border-color); color: var(--primary-text);
            padding: 10px; border-radius: 6px; box-sizing: border-box; font-family: var(--font-kurdish);
        }
        textarea { min-height: 100px; resize: vertical; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid var(--border-color); padding: 10px; text-align: right; }
        th { background: var(--card-bg); }
        .actions button { margin-left: 5px; padding: 5px 8px; font-size: 0.9rem; }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div id="login-screen">
        <div id="login-form">
            <h1>چوونا ژۆر - ئەدمین</h1>
            <div class="form-group">
                <label for="email">ئیمێل</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="password">پاسۆرد</label>
                <input type="password" id="password" required>
            </div>
            <button id="login-btn" style="width: 100%;">چوونا ژۆر</button>
            <p id="login-error" style="color: var(--danger-color); text-align: center; margin-top: 10px;"></p>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <header>
            <h3>پەنجەرا ئەدمین - پڕۆژێ ئیسلام</h3>
            <div>
                <span id="user-email" style="margin-left: 20px;"></span>
                <button id="logout-btn" class="danger">دەرکەفتن</button>
            </div>
        </header>
        <div class="main-layout">
            <nav>
                <ul>
                    <li><button class="nav-btn" data-target="teachers">مامۆستایان</button></li>
                    <li><button class="nav-btn" data-target="generalLectures">وانەیێن گشتی</button></li>
                    <li><button class="nav-btn" data-target="books">پەرتوکخانە</button></li>
                    <li><button class="nav-btn" data-target="levels">رێرەوا فێربوونێ</button></li>
                    <li><button class="nav-btn" data-target="fatwas">پرسیار و بەرسڤ</button></li>
                    <li><button class="nav-btn" data-target="hadiths">حەدیسان</button></li>
                    <li><button class="nav-btn" data-target="tafsir">تەفسیر</button></li>
                    <li><button class="nav-btn" data-target="viewStatus">کۆنترۆلا بەشان</button></li>
                    <!-- Add other navigation buttons here -->
                </ul>
            </nav>
            <main>
                <!-- Teachers Section -->
                <section id="content-teachers" class="content-section">
                    <h2>کۆنترۆلا مامۆستایان</h2>
                    <form id="teacher-form">
                        <input type="hidden" id="teacher-id">
                        <div class="form-group"><label>ID (بۆ نموونە: mamosta1)</label><input type="text" id="teacher-form-id" required></div>
                        <div class="form-group"><label>ناڤ</label><input type="text" id="teacher-name" required></div>
                        <div class="form-group"><label>لینکێ وێنەیێ پرۆفایلی</label><input type="url" id="teacher-profileimage"></div>
                        <div class="form-group"><label>کورتەیەک (Bio)</label><textarea id="teacher-bio"></textarea></div>
                        <div class="form-group"><label>ژمارا تەلەفونێ</label><input type="text" id="teacher-phone"></div>
                        <div class="form-group"><label>لینکێ یوتوبی</label><input type="url" id="teacher-social_youtube"></div>
                        <div class="form-group"><label>لینکێ تێلێگرامی</label><input type="url" id="teacher-social_telegram"></div>
                        <div class="form-group"><label>لینکێ فەیسبوکی</label><input type="url" id="teacher-social_facebook"></div>
                        <button type="submit">تۆمارکرن</button>
                        <button type="button" id="cancel-teacher-edit" style="display:none;" class="danger">هەلوەشاندن</button>
                    </form>
                    <table id="teachers-table">
                        <thead><tr><th>ID</th><th>ناڤ</th><th>کارپێکرن</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </section>
                
                <!-- General Lectures Section -->
                <section id="content-generalLectures" class="content-section">
                    <h2>کۆنترۆلا وانەیێن گشتی</h2>
                    <form id="lecture-form">
                         <input type="hidden" id="lecture-fb-id">
                        <div class="form-group"><label>ID وانەیێ (بۆ نموونە: wane1)</label><input type="text" id="lecture-form-id" required></div>
                        <div class="form-group"><label>ناڤێ وانەیێ</label><input type="text" id="lecture-title" required></div>
                        <div class="form-group"><label>ID مامۆستای</label><select id="lecture-teacherid"></select></div>
                        <div class="form-group"><label>بابەت (Category)</label><input type="text" id="lecture-category"></div>
                        <div class="form-group"><label>لینکێ وێنەیێ بەرگی</label><input type="url" id="lecture-image"></div>
                        <div class="form-group"><label>لینکێ PDF</label><input type="url" id="lecture-pdfurl"></div>
                        <div class="form-group"><label>ڤیدیۆکان (ناڤێ ڤیدیۆیێ;لینک|ناڤێ ڤیدیۆیێ٢;لینک)</label><textarea id="lecture-videos"></textarea></div>
                        <button type="submit">تۆمارکرن</button>
                        <button type="button" id="cancel-lecture-edit" style="display:none;" class="danger">هەلوەشاندن</button>
                    </form>
                    <table id="lectures-table">
                        <thead><tr><th>ناڤ</th><th>مامۆستا</th><th>کارپێکرن</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </section>

                <!-- ... Sections for other data types (books, levels, etc.) will go here ... -->

            </main>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyDDi3HtFigGy3qFpFVhSATal3yzm7Z_dZA",
          authDomain: "projeislam.firebaseapp.com",
          projectId: "projeislam",
          storageBucket: "projeislam.appspot.com",
          messagingSenderId: "686343038831",
          appId: "1:686343038831:web:745161e7543b53aa0b6a9a"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const userEmailSpan = document.getElementById('user-email');
        const loginError = document.getElementById('login-error');
        const navButtons = document.querySelectorAll('.nav-btn');
        const contentSections = document.querySelectorAll('.content-section');
        
        // --- AUTHENTICATION ---
        auth.onAuthStateChanged(user => {
            if (user) {
                // User is signed in
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'block';
                userEmailSpan.textContent = user.email;
                // Load initial data
                showSection('teachers');
                loadTeachers();
            } else {
                // User is signed out
                loginScreen.style.display = 'flex';
                adminPanel.style.display = 'none';
                userEmailSpan.textContent = '';
            }
        });

        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, password)
                .catch(error => {
                    loginError.textContent = "ئیمێل یان پاسۆرد خەلەتە.";
                    console.error("Login Error:", error);
                });
        });

        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });

        // --- NAVIGATION ---
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = button.dataset.target;
                showSection(targetId);
            });
        });
        
        function showSection(targetId) {
             navButtons.forEach(btn => btn.classList.remove('active'));
             document.querySelector(`.nav-btn[data-target="${targetId}"]`).classList.add('active');

             contentSections.forEach(section => section.classList.remove('active'));
             document.getElementById(`content-${targetId}`).classList.add('active');

             // Load data for the shown section
             if (targetId === 'teachers') loadTeachers();
             if (targetId === 'generalLectures') loadLectures();
             // Add loaders for other sections here
        }

        // --- CRUD OPERATIONS: TEACHERS ---
        const teacherForm = document.getElementById('teacher-form');
        const teachersTableBody = document.querySelector('#teachers-table tbody');
        const cancelTeacherEditBtn = document.getElementById('cancel-teacher-edit');

        async function loadTeachers() {
            teachersTableBody.innerHTML = '<tr><td colspan="3">بارکرن...</td></tr>';
            const snapshot = await db.collection('teachers').get();
            teachersTableBody.innerHTML = '';
            snapshot.forEach(doc => {
                const teacher = doc.data();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${teacher.id}</td>
                    <td>${teacher.name}</td>
                    <td class="actions">
                        <button onclick="editTeacher('${doc.id}')">دەستکاری</button>
                        <button class="danger" onclick="deleteTeacher('${doc.id}')">ژێبرن</button>
                    </td>
                `;
                teachersTableBody.appendChild(tr);
            });
            // Update teacher dropdown in lectures section
            updateTeacherDropdown();
        }

        teacherForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const docId = document.getElementById('teacher-id').value;
            const teacherData = {
                id: document.getElementById('teacher-form-id').value,
                name: document.getElementById('teacher-name').value,
                profileimage: document.getElementById('teacher-profileimage').value,
                bio: document.getElementById('teacher-bio').value,
                phone: document.getElementById('teacher-phone').value,
                social_youtube: document.getElementById('teacher-social_youtube').value,
                social_telegram: document.getElementById('teacher-social_telegram').value,
                social_facebook: document.getElementById('teacher-social_facebook').value,
            };

            if (docId) { // Update
                await db.collection('teachers').doc(docId).set(teacherData);
            } else { // Add
                await db.collection('teachers').add(teacherData);
            }
            teacherForm.reset();
            document.getElementById('teacher-id').value = '';
            cancelTeacherEditBtn.style.display = 'none';
            loadTeachers();
        });

        async function editTeacher(docId) {
            const doc = await db.collection('teachers').doc(docId).get();
            const teacher = doc.data();
            document.getElementById('teacher-id').value = doc.id;
            document.getElementById('teacher-form-id').value = teacher.id;
            document.getElementById('teacher-name').value = teacher.name;
            document.getElementById('teacher-profileimage').value = teacher.profileimage;
            document.getElementById('teacher-bio').value = teacher.bio;
            document.getElementById('teacher-phone').value = teacher.phone;
            document.getElementById('teacher-social_youtube').value = teacher.social_youtube;
            document.getElementById('teacher-social_telegram').value = teacher.social_telegram;
            document.getElementById('teacher-social_facebook').value = teacher.social_facebook;
            cancelTeacherEditBtn.style.display = 'inline-block';
            window.scrollTo(0, 0);
        }

        async function deleteTeacher(docId) {
            if (confirm('تۆ پشتراستی ژ ژێبرنا ڤی مامۆستای؟')) {
                await db.collection('teachers').doc(docId).delete();
                loadTeachers();
            }
        }

        cancelTeacherEditBtn.addEventListener('click', () => {
            teacherForm.reset();
            document.getElementById('teacher-id').value = '';
            cancelTeacherEditBtn.style.display = 'none';
        });

        // --- CRUD OPERATIONS: LECTURES ---
        const lectureForm = document.getElementById('lecture-form');
        const lecturesTableBody = document.querySelector('#lectures-table tbody');
        const lectureTeacherIdSelect = document.getElementById('lecture-teacherid');
        const cancelLectureEditBtn = document.getElementById('cancel-lecture-edit');
        let teachersCache = {};

        async function updateTeacherDropdown() {
            const snapshot = await db.collection('teachers').get();
            teachersCache = {};
            lectureTeacherIdSelect.innerHTML = '<option value="">مامۆستا هەلبژێرە</option>';
            snapshot.forEach(doc => {
                const teacher = doc.data();
                teachersCache[teacher.id] = teacher.name;
                const option = document.createElement('option');
                option.value = teacher.id;
                option.textContent = teacher.name;
                lectureTeacherIdSelect.appendChild(option);
            });
        }
        
        async function loadLectures() {
            lecturesTableBody.innerHTML = '<tr><td colspan="3">بارکرن...</td></tr>';
            const snapshot = await db.collection('generalLectures').get();
            lecturesTableBody.innerHTML = '';
            snapshot.forEach(doc => {
                const lecture = doc.data();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${lecture.title}</td>
                    <td>${teachersCache[lecture.teacherid] || lecture.teacherid}</td>
                    <td class="actions">
                        <button onclick="editLecture('${doc.id}')">دەستکاری</button>
                        <button class="danger" onclick="deleteLecture('${doc.id}')">ژێبرن</button>
                    </td>
                `;
                lecturesTableBody.appendChild(tr);
            });
        }
        
        lectureForm.addEventListener('submit', async (e) => {
             e.preventDefault();
            const docId = document.getElementById('lecture-fb-id').value;
            const lectureData = {
                id: document.getElementById('lecture-form-id').value,
                title: document.getElementById('lecture-title').value,
                teacherid: document.getElementById('lecture-teacherid').value,
                category: document.getElementById('lecture-category').value,
                image: document.getElementById('lecture-image').value,
                pdfurl: document.getElementById('lecture-pdfurl').value,
                videos: document.getElementById('lecture-videos').value,
            };

            if (docId) { // Update
                await db.collection('generalLectures').doc(docId).set(lectureData);
            } else { // Add
                await db.collection('generalLectures').add(lectureData);
            }
            lectureForm.reset();
            document.getElementById('lecture-fb-id').value = '';
            cancelLectureEditBtn.style.display = 'none';
            loadLectures();
        });
        
        async function editLecture(docId) {
            const doc = await db.collection('generalLectures').doc(docId).get();
            const lecture = doc.data();
            document.getElementById('lecture-fb-id').value = doc.id;
            document.getElementById('lecture-form-id').value = lecture.id;
            document.getElementById('lecture-title').value = lecture.title;
            document.getElementById('lecture-teacherid').value = lecture.teacherid;
            document.getElementById('lecture-category').value = lecture.category;
            document.getElementById('lecture-image').value = lecture.image;
            document.getElementById('lecture-pdfurl').value = lecture.pdfurl;
            document.getElementById('lecture-videos').value = lecture.videos;
            
            cancelLectureEditBtn.style.display = 'inline-block';
            window.scrollTo(0, 0);
        }
        
        async function deleteLecture(docId) {
            if (confirm('تۆ پشتراستی ژ ژێبرنا ڤێ وانەیێ؟')) {
                await db.collection('generalLectures').doc(docId).delete();
                loadLectures();
            }
        }
        
         cancelLectureEditBtn.addEventListener('click', () => {
            lectureForm.reset();
            document.getElementById('lecture-fb-id').value = '';
            cancelLectureEditBtn.style.display = 'none';
        });

    </script>
</body>
</html>
