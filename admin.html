
<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پانێلا ئەدمین - پڕۆژێ ئیسلام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --dark-bg: #0d1117; --card-bg: #161b22; --primary-text: #c9d1d9; --secondary-text: #8b949e;
            --accent-color: #58a6ff; --border-color: #30363d; --success-color: #2ea043; --danger-color: #f85149;
            --font-kurdish: 'Noto Sans Arabic', sans-serif;
        }
        body { font-family: var(--font-kurdish); background-color: var(--dark-bg); color: var(--primary-text); line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .login-container, .admin-panel { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; padding: 30px; }
        h1, h2, h3 { color: var(--primary-text); border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; background: var(--dark-bg); border: 1px solid var(--border-color); color: var(--primary-text); padding: 10px; border-radius: 6px; box-sizing: border-box; }
        button { background: var(--accent-color); color: #fff; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; }
        button.danger { background-color: var(--danger-color); }
        #admin-panel { display: none; }
        .admin-nav { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-btn { background: var(--border-color); }
        .nav-btn.active { background: var(--accent-color); }
        .admin-section { display: none; }
        .admin-section.active { display: block; }
        .item-list { list-style: none; padding: 0; }
        .item-list li { background: var(--dark-bg); padding: 10px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="container">
    <!-- بەشێ لۆگینێ -->
    <div id="login-container" class="login-container">
        <h1><i class="fas fa-lock"></i> لۆگینا ئەدمینی</h1>
        <form id="login-form">
            <div class="form-group">
                <label for="email">ئیمێل</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="password">پاسۆرد</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit">چوونەژوور</button>
            <p id="login-error" style="color: var(--danger-color); margin-top: 10px;"></p>
        </form>
    </div>

    <!-- پانێلا ئەدمینی (ڤەشارتیە) -->
    <div id="admin-panel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1><i class="fas fa-tools"></i> پانێلا ئەدمین</h1>
            <button id="logout-btn" class="danger">چوونەدەر</button>
        </div>
        <p>ل ڤێرێ دشێی هەمی ناڤەرۆکا مالپەری کۆنترۆل بکەی. هەر گوهۆرینەک راستەوخۆ دێ ل مالپەرێ گشتی دیار بیت.</p>
        
        <nav class="admin-nav">
             <button class="nav-btn active" data-target="site-settings-section">ڕێکخستنێن گشتی</button>
             <button class="nav-btn" data-target="teachers-section">مامۆستایان</button>
             <!-- لێرە بەشەکانی تر زیاد بکە -->
        </nav>

        <div class="admin-content">
            <!-- بەشێ ڕێکخستنێن گشتی و قفل کرنا بەشان -->
            <div id="site-settings-section" class="admin-section active">
                <h2><i class="fas fa-cogs"></i> بەڕێوەبرنا بەشان (قفل کرن / ڤەکرن)</h2>
                <form id="view-status-form">
                    <p>0: چالاک | 1: د کارکرنێ دایە | 8: قفلە</p>
                    <!-- لڤێرێ دێ ب شێوەیەکێ ئۆتۆماتیکی پڕ بیت -->
                </form>
                <button id="save-view-status">هەلگرتنا گوهۆرینان</button>
                 <p id="status-save-message" style="color: var(--success-color); margin-top: 10px;"></p>
            </div>

            <!-- بەشێ مامۆستایان -->
            <div id="teachers-section" class="admin-section">
                <h2><i class="fas fa-chalkboard-teacher"></i> بەڕێوەبرنا مامۆستایان</h2>
                <form id="teacher-form">
                    <input type="hidden" id="teacher-id">
                    <div class="form-group"><label for="teacher-name">ناڤ</label><input type="text" id="teacher-name" required></div>
                    <div class="form-group"><label for="teacher-bio">کورتەیا ژیانێ</label><textarea id="teacher-bio"></textarea></div>
                    <div class="form-group"><label for="teacher-image">لینکێ وێنەی</label><input type="text" id="teacher-image"></div>
                    <div class="form-group"><label for="teacher-telegram">لینکێ تێلێگرامی</label><input type="text" id="teacher-telegram"></div>
                    <button type="submit">هەلگرتن</button>
                </form>
                <h3>لیستا مامۆستایان</h3>
                <ul id="teachers-list" class="item-list"></ul>
            </div>
            
            <!-- لڤێرێ بەشێن دی بۆ (وانە، حەدیس، فەتوا...) دێ چێکەین -->
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDDi3HtFigGy3qFpFVhSATal3yzm7Z_dZA",
      authDomain: "projeislam.firebaseapp.com",
      projectId: "projeislam",
      storageBucket: "projeislam.appspot.com",
      messagingSenderId: "686343038831",
      appId: "1:686343038831:web:745161e7543b53aa0b6a9a",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginContainer = document.getElementById('login-container');
    const adminPanel = document.getElementById('admin-panel');
    const loginForm = document.getElementById('login-form');
    const logoutBtn = document.getElementById('logout-btn');

    // چاڤدێریا حالەتێ لۆگینێ
    auth.onAuthStateChanged(user => {
        if (user) {
            loginContainer.style.display = 'none';
            adminPanel.style.display = 'block';
            loadAdminData();
        } else {
            loginContainer.style.display = 'block';
            adminPanel.style.display = 'none';
        }
    });

    // لۆگین کرن
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => {
                document.getElementById('login-error').textContent = "ئیمەیل یان پاسۆرد خەلەتە.";
                console.error("Login Error:", error);
            });
    });

    // لۆگ ئاوت کرن
    logoutBtn.addEventListener('click', () => {
        auth.signOut();
    });

    // گوهۆرینا تابێن ناڤ پانێلێ
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.admin-section').forEach(sec => sec.classList.remove('active'));
            document.getElementById(btn.dataset.target).classList.add('active');
        });
    });

    // === لۆژیکا تایبەت ب هەر بەشەکی ===
    function loadAdminData() {
        loadViewStatuses();
        loadTeachers();
        // ... load other sections
    }

    // --- بەڕێوەبرنا بەشان ---
    async function loadViewStatuses() {
        const form = document.getElementById('view-status-form');
        const doc = await db.collection('single_docs').doc('viewStatuses').get();
        if (doc.exists) {
            const statuses = doc.data();
            let html = '';
            for (const key in statuses) {
                html += `<div class="form-group">
                            <label for="status-${key}">${key}</label>
                            <input type="text" id="status-${key}" data-key="${key}" value="${statuses[key]}">
                         </div>`;
            }
            form.innerHTML = html;
        }
    }
    document.getElementById('save-view-status').addEventListener('click', async () => {
        const inputs = document.querySelectorAll('#view-status-form input');
        const newStatuses = {};
        inputs.forEach(input => {
            newStatuses[input.dataset.key] = input.value;
        });
        await db.collection('single_docs').doc('viewStatuses').set(newStatuses);
        const msg = document.getElementById('status-save-message');
        msg.textContent = 'گوهۆرین ب سەرکەفتی هاتە هەلگرتن!';
        setTimeout(() => msg.textContent = '', 3000);
    });

    // --- بەڕێوەبرنا مامۆستایان ---
    const teachersCollection = db.collection('teachers');
    const teacherForm = document.getElementById('teacher-form');
    const teachersList = document.getElementById('teachers-list');

    async function loadTeachers() {
        const snapshot = await teachersCollection.get();
        teachersList.innerHTML = '';
        snapshot.forEach(doc => {
            const teacher = { id: doc.id, ...doc.data() };
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${teacher.name}</span>
                <div>
                    <button onclick="editTeacher('${teacher.id}')">دەستکاری</button>
                    <button class="danger" onclick="deleteTeacher('${teacher.id}')">ژێبرن</button>
                </div>`;
            teachersList.appendChild(li);
        });
    }

    teacherForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('teacher-id').value;
        const data = {
            name: document.getElementById('teacher-name').value,
            bio: document.getElementById('teacher-bio').value,
            profileImage: document.getElementById('teacher-image').value,
            social: { telegram: document.getElementById('teacher-telegram').value }
        };

        if (id) {
            await teachersCollection.doc(id).update(data);
        } else {
            await teachersCollection.add(data);
        }
        teacherForm.reset();
        document.getElementById('teacher-id').value = '';
        loadTeachers();
    });

    async function editTeacher(id) {
        const doc = await teachersCollection.doc(id).get();
        const teacher = doc.data();
        document.getElementById('teacher-id').value = id;
        document.getElementById('teacher-name').value = teacher.name;
        document.getElementById('teacher-bio').value = teacher.bio;
        document.getElementById('teacher-image').value = teacher.profileImage;
        document.getElementById('teacher-telegram').value = teacher.social.telegram;
        window.scrollTo({top: teacherForm.offsetTop, behavior: 'smooth'});
    }

    async function deleteTeacher(id) {
        if (confirm('تۆ دڵنیای دێ ڤی مامۆستای ژێبەی؟')) {
            await teachersCollection.doc(id).delete();
            loadTeachers();
        }
    }
    // Make functions globally accessible for onclick handlers
    window.editTeacher = editTeacher;
    window.deleteTeacher = deleteTeacher;
</script>

</body>
</html>
