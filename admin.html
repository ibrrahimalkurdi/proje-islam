
<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پەنێلا کۆنترۆلێ - پرۆژێ ئیسلام</title>
    <style>
        :root { --dark-bg: #0d1117; --card-bg: #161b22; --primary-text: #c9d1d9; --secondary-text: #8b949e; --accent-color: #58a6ff; --border-color: #30363d; --success-color: #2ea043; --danger-color: #f85149; --font-kurdish: 'Noto Sans Arabic', sans-serif; }
        body { font-family: var(--font-kurdish); background-color: var(--dark-bg); color: var(--primary-text); line-height: 1.6; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        h1, h2, h3 { color: var(--accent-color); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; }
        #login-section, #admin-panel { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 25px; margin-top: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; background: var(--dark-bg); border: 1px solid var(--border-color); color: var(--primary-text); padding: 10px; border-radius: 6px; font-family: var(--font-kurdish); box-sizing: border-box; }
        button { background: var(--accent-color); color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-family: var(--font-kurdish); font-size: 1rem; }
        button:hover { opacity: 0.9; }
        button.danger { background: var(--danger-color); }
        #admin-panel { display: none; }
        .item-list { list-style: none; padding: 0; }
        .item-list li { background: var(--dark-bg); padding: 15px; border-radius: 6px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        #status-message { text-align: center; margin-top: 15px; font-weight: bold; }
        #user-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 25px; margin-bottom: 25px; }
    </style>
</head>
<body>

<div class="container">
    <h1>پەنێلا کۆنترۆلێ</h1>
    
    <!-- Login Section -->
    <div id="login-section">
        <h2>چوونا ژۆر</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="email">ئیمێل</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="password">پاسۆرد</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit">چوونا ژۆر</button>
            <p id="login-error" style="color: var(--danger-color); margin-top: 10px;"></p>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="admin-panel">
        <div id="user-info">
            <span id="user-email"></span>
            <button id="logout-btn" class="danger">دەرچوون</button>
        </div>
        <p id="status-message"></p>

        <!-- View Status Management -->
        <div class="section-card">
            <h3>کۆنترۆلا بەشان (قفلکرن/ڤەکرن)</h3>
            <form id="view-status-form">
                <div id="view-status-list">Loading...</div>
                <br>
                <button type="submit">پاشکەفتکرنا گوهۆرینان</button>
            </form>
        </div>

        <!-- Teachers Management -->
        <div class="section-card">
            <h3>رێڤەبرنا مامۆستایان</h3>
            <form id="teacher-form">
                <input type="hidden" id="teacher-id">
                <div class="form-group"><label for="teacher-name">ناڤێ مامۆستای</label><input type="text" id="teacher-name" required></div>
                <div class="form-group"><label for="teacher-bio">کورتەیەک لسەر مامۆستای</label><input type="text" id="teacher-bio"></div>
                <div class="form-group"><label for="teacher-image">لینکێ وێنەی</label><input type="url" id="teacher-image"></div>
                <div class="form-group"><label for="teacher-telegram">لینکێ تێلەگرامی</label><input type="url" id="teacher-telegram"></div>
                 <!-- Add more fields for social media as needed -->
                <button type="submit">پاشکەفتکرن</button>
            </form>
            <hr style="border-color: var(--border-color); margin: 20px 0;">
            <h4>لیستا مامۆستایان</h4>
            <ul id="teachers-list" class="item-list"></ul>
        </div>
        
        <!-- Add more sections here for fatwas, hadiths, etc. following the same pattern -->

    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    // **گرنگ:** هەمان Firebase config ل ڤێرێ ژی دابنە
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        databaseURL: "YOUR_DATABASE_URL",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // Elements
    const loginSection = document.getElementById('login-section');
    const adminPanel = document.getElementById('admin-panel');
    const loginForm = document.getElementById('login-form');
    const loginError = document.getElementById('login-error');
    const userEmail = document.getElementById('user-email');
    const logoutBtn = document.getElementById('logout-btn');
    const statusMessage = document.getElementById('status-message');

    // Auth State Listener
    auth.onAuthStateChanged(user => {
        if (user) {
            loginSection.style.display = 'none';
            adminPanel.style.display = 'block';
            userEmail.textContent = `بخێر هاتن, ${user.email}`;
            loadAdminData();
        } else {
            loginSection.style.display = 'block';
            adminPanel.style.display = 'none';
        }
    });

    // Login
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => {
                loginError.textContent = "ئیمێل یان پاسۆرد خەلەتە.";
                console.error("Login Error:", error);
            });
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
        auth.signOut();
    });
    
    function showStatusMessage(message, isError = false) {
        statusMessage.textContent = message;
        statusMessage.style.color = isError ? 'var(--danger-color)' : 'var(--success-color)';
        setTimeout(() => { statusMessage.textContent = ''; }, 3000);
    }
    
    // ================== ADMIN DATA MANAGEMENT ==================
    function loadAdminData() {
        loadTeachers();
        loadViewStatuses();
        // Call other load functions here
    }

    // --- Teachers Management ---
    const teacherForm = document.getElementById('teacher-form');
    const teachersList = document.getElementById('teachers-list');
    
    teacherForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = document.getElementById('teacher-id').value || database.ref().child('teachers').push().key;
        const teacherData = {
            id: id,
            name: document.getElementById('teacher-name').value,
            bio: document.getElementById('teacher-bio').value,
            profileImage: document.getElementById('teacher-image').value,
            social: {
                telegram: document.getElementById('teacher-telegram').value,
                // you can add more social links here
            }
        };

        database.ref('teachers/' + id).set(teacherData)
            .then(() => {
                showStatusMessage('مامۆستا ب سەرکەفتی هاتە پاشکەفتکرن.');
                teacherForm.reset();
                loadTeachers();
            })
            .catch(err => showStatusMessage('چەوتیەک روویدا!', true));
    });

    function loadTeachers() {
        database.ref('teachers').once('value', snapshot => {
            teachersList.innerHTML = '';
            const teachers = snapshot.val();
            if (teachers) {
                Object.entries(teachers).forEach(([key, teacher]) => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <span>${teacher.name}</span>
                        <div>
                            <button onclick="editTeacher('${key}')">دەستکاری</button>
                            <button class="danger" onclick="deleteTeacher('${key}')">ژێبرن</button>
                        </div>
                    `;
                    teachersList.appendChild(li);
                });
            }
        });
    }

    window.editTeacher = (id) => {
        database.ref('teachers/' + id).once('value', snapshot => {
            const teacher = snapshot.val();
            document.getElementById('teacher-id').value = id;
            document.getElementById('teacher-name').value = teacher.name;
            document.getElementById('teacher-bio').value = teacher.bio;
            document.getElementById('teacher-image').value = teacher.profileImage;
            document.getElementById('teacher-telegram').value = teacher.social.telegram;
            teacherForm.scrollIntoView();
        });
    };

    window.deleteTeacher = (id) => {
        if (confirm('تۆ پشتراستی دێ ڤی مامۆستای ژێبەی؟')) {
            database.ref('teachers/' + id).remove()
                .then(() => {
                    showStatusMessage('مامۆستا هاتە ژێبرن.');
                    loadTeachers();
                })
                .catch(err => showStatusMessage('چەوتیەک د ژێبرنێ دا روویدا!', true));
        }
    };
    
    // --- View Status Management ---
    const viewStatusForm = document.getElementById('view-status-form');
    const viewStatusList = document.getElementById('view-status-list');
    
    function loadViewStatuses() {
        database.ref('viewStatuses').once('value', snapshot => {
            const statuses = snapshot.val();
            viewStatusList.innerHTML = '';
            if(statuses) {
                Object.entries(statuses).forEach(([key, value]) => {
                    const div = document.createElement('div');
                    div.className = 'form-group';
                    div.innerHTML = `
                        <label for="status-${key}">${key.replace('-view', '')}</label>
                        <select id="status-${key}" data-view-key="${key}">
                            <option value="0" ${value === '0' ? 'selected' : ''}>0 - بکاردکەڤیت (Active)</option>
                            <option value="1" ${value === '1' ? 'selected' : ''}>1 - د کارکرنێ دایە (Soon)</option>
                            <option value="8" ${value === '8' ? 'selected' : ''}>8 - قفلە (Locked)</option>
                            <option value="2" ${value === '2' ? 'selected' : ''}>2 - ئاریشە (Error)</option>
                            <option value="3" ${value === '3' ? 'selected' : ''}>3 - ژێر چاککرنێ (Maintenance)</option>
                        </select>
                    `;
                    viewStatusList.appendChild(div);
                });
            }
        });
    }

    viewStatusForm.addEventListener('submit', e => {
        e.preventDefault();
        const updates = {};
        viewStatusList.querySelectorAll('select').forEach(select => {
            const key = select.dataset.viewKey;
            const value = select.value;
            updates[key] = value;
        });
        
        database.ref('viewStatuses').update(updates)
            .then(() => showStatusMessage('حالەتێ بەشان ب سەرکەفتی هاتە نووکرن.'))
            .catch(err => showStatusMessage('چەوتیەک روویدا!', true));
    });
</script>

</body>
</html>
