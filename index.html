<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پرۆژێ زانست</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />

    <style>
        :root { --dark-bg: #0d1117; --primary-text: #c9d1d9; --secondary-text: #8b949e; --accent-color: #58a6ff; --border-color: #30363d; --card-bg: #161b22; --font-kurdish: 'Noto Sans Arabic', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-kurdish); background-color: var(--dark-bg); color: var(--primary-text); line-height: 1.7; }
        a { color: var(--accent-color); text-decoration: none; }
        a:hover { text-decoration: underline; }
        .container { width: 90%; max-width: 1200px; margin: auto; }
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1f2e 100%); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease-out; }
        #loading-screen.fade-out { opacity: 0; pointer-events: none; }
        .loading-logo { font-size: 4rem; font-weight: 700; color: var(--primary-text); margin-bottom: 20px; animation: pulse 2s infinite; }
        .loading-logo span { color: var(--accent-color); }
        .welcome-text { font-size: 1.5rem; color: var(--secondary-text); text-align: center; margin-bottom: 30px; animation: fadeInUp 1s ease-out 0.5s both; }
        .loading-spinner { width: 50px; height: 50px; border: 3px solid var(--border-color); border-top: 3px solid var(--accent-color); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        header { position: sticky; top: 0; width: 100%; padding: 15px 0; z-index: 1000; background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border-color); }
        header .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .logo { font-size: 26px; font-weight: 700; text-decoration: none; color: var(--primary-text); cursor: pointer; }
        .logo span { color: var(--accent-color); }
        nav { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
        nav a { color: var(--secondary-text); text-decoration: none; padding: 8px 16px; font-weight: 500; transition: color 0.3s, border-bottom-color 0.3s; cursor: pointer; border-bottom: 2px solid transparent; }
        nav a:hover, nav a.active { color: var(--primary-text); border-bottom-color: var(--accent-color); }
        #search-icon-btn { background: none; border: none; color: var(--secondary-text); font-size: 1.2rem; cursor: pointer; padding: 5px; transition: color 0.3s; }
        #search-icon-btn:hover { color: var(--accent-color); }
        #search-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(13, 17, 23, 0.95); z-index: 3000; display: none; align-items: flex-start; justify-content: center; padding-top: 10vh; overflow-y: auto; }
        #search-overlay.active { display: flex; animation: fadeIn 0.3s; }
        .search-modal-content { width: 90%; max-width: 700px; }
        #search-input-field { width: 100%; background: transparent; border: none; border-bottom: 2px solid var(--border-color); color: var(--primary-text); font-size: 2rem; padding: 15px 0; margin-bottom: 30px; text-align: center; font-family: var(--font-kurdish); }
        #search-input-field:focus { outline: none; border-bottom-color: var(--accent-color); }
        #search-results-container { max-height: 60vh; overflow-y: auto; }
        #close-search-btn { position: absolute; top: 30px; right: 40px; color: var(--secondary-text); font-size: 2.5rem; cursor: pointer; }
        footer { padding: 40px 0; text-align: center; border-top: 1px solid var(--border-color); margin-top: 50px; color: var(--secondary-text); }
        .view { display: none; }
        .view.is-active { display: block; animation: fadeIn 0.5s ease-in-out; }
        .page-header { text-align: center; padding: 50px 20px; } .page-header h1 { font-size: 2.8rem; margin-bottom: 10px; }
        .back-btn { background: none; border: none; color: var(--secondary-text); font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-bottom: 30px; }
        .accordion { background: transparent; color: var(--primary-text); cursor: pointer; padding: 18px 25px; width: 100%; border: 1px solid var(--border-color); border-radius: 8px; text-align: right; font-size: 1.2rem; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; transition: all 0.3s; }
        .accordion .icon { transition: transform 0.3s ease-out; } .accordion.active .icon { transform: rotate(90deg); }
        .accordion:hover, .accordion.active { border-color: var(--accent-color); background: var(--card-bg); }
        .panel { padding: 5px 20px; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out; }
        .item-card { background: var(--card-bg); border-left: 3px solid transparent; border-radius: 6px; padding: 15px 20px; margin: 10px 0; cursor: pointer; transition: all 0.3s; }
        .item-card:hover { border-left-color: var(--accent-color); transform: translateX(5px); }
        #reading-view .reading-layout { display: flex; flex-direction: column; } .sharah-wrapper { background-color: var(--card-bg); border-radius: 10px; padding: 25px; margin-bottom: 40px; }
        .sharah-header { border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 20px; }
        .sharah-header h2 { font-size: 2rem; margin: 0; text-align: center;}
        .teacher-tabs { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-bottom: 25px; align-items: center; }
        .teacher-tab { background: var(--dark-bg); border: 1px solid var(--border-color); color: var(--secondary-text); padding: 8px 20px; border-radius: 50px; cursor: pointer; font-weight: bold; }
        .teacher-tab a { color: inherit; text-decoration: none;}
        .teacher-tab.active { background: var(--accent-color); color: var(--dark-bg); border-color: var(--accent-color); }
        #matn-content-container p { font-size: 1.6rem; line-height: 2.4; color: var(--secondary-text); text-align: center; margin-bottom: 1.5em; }
        .search-result-item { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 20px; cursor: pointer; transition: all 0.3s; }
        .search-result-item:hover { border-color: var(--accent-color); transform: translateY(-3px); }
        .search-result-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        .search-result-item .item-type { font-size: 0.8rem; background: var(--accent-color); color: var(--dark-bg); font-weight: bold; padding: 2px 8px; border-radius: 10px; }
        .filters-container { display: flex; flex-direction: column; gap: 20px; margin-bottom: 40px; align-items: center; background: var(--card-bg); padding: 20px; border-radius: 10px; border: 1px solid var(--border-color);}
        .filter-group { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 10px; }
        .filter-group h4 { margin: 0 15px 0 0; font-weight: 500; color: var(--primary-text); }
        .filter-btn { background: var(--dark-bg); border: 1px solid var(--border-color); color: var(--secondary-text); padding: 8px 20px; border-radius: 50px; cursor: pointer; }
        .filter-btn:hover, .filter-btn.active { background: var(--accent-color); color: var(--dark-bg); border-color: var(--accent-color); }
        .waneyan-grid, .pirtuk-grid { display: grid; gap: 25px; } .waneyan-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); } .pirtuk-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
        .wana-card, .pirtuk-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; transition: all 0.3s; }
        .wana-card:hover, .pirtuk-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); border-color: var(--accent-color); }
        .wana-card-img, .pirtuk-card-img { width: 100%; object-fit: cover; } .wana-card-img { height: 180px; } .pirtuk-card-img { height: 320px; border-bottom: 1px solid var(--border-color);}
        .wana-card-content, .pirtuk-card-content { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-btn-group { display: flex; gap: 10px; margin-top: auto; padding-top: 15px; }
        .card-btn-small { flex: 1; background: var(--accent-color); color: #fff; padding: 10px; text-align: center; text-decoration: none; border-radius: 8px; font-weight: bold; border: none; cursor: pointer; font-size: 0.9rem; transition: background-color 0.3s; }
        .card-btn-small.secondary { background: var(--border-color); } .card-btn-small:hover { opacity: 0.9; }
        .lesson-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-radius: 6px; margin-bottom: 8px; background: rgba(0,0,0,0.2); border-right: 3px solid var(--border-color); transition: border-color .3s; }
        .lesson-item:hover { border-right-color: var(--accent-color); } .lesson-item span { font-size: 1rem; } .lesson-item.clickable { cursor: pointer; } .watch-btn { background: none; border: 1px solid var(--accent-color); color: var(--accent-color); padding: 5px 12px; border-radius: 5px; cursor: pointer; }
        #teacher-stories-bar { display: flex; gap: 20px; overflow-x: auto; padding: 20px 10px; margin-bottom: 25px; scrollbar-width: none; } #teacher-stories-bar::-webkit-scrollbar { display: none; }
        .teacher-story { display: flex; flex-direction: column; align-items: center; gap: 8px; flex-shrink: 0; }
        .story-avatar-wrapper { cursor: pointer; } .teacher-story .story-avatar { width: 70px; height: 70px; border-radius: 50%; padding: 3px; background: var(--accent-color); }
        .teacher-story .story-avatar img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; border: 3px solid var(--dark-bg); }
        .story-profile-link { font-size: 0.75rem; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-overlay.is-visible { display: flex; animation: fadeIn 0.3s; }
        .modal-content { position: relative; width: 90%; background:var(--card-bg); border-radius:10px; }
        .close-modal-btn { position: absolute; top: 15px; right: 20px; color: var(--secondary-text); font-size: 2rem; cursor: pointer; z-index: 10; }
        #lesson-list-modal .modal-content { max-width: 600px; padding: 30px; } #lesson-list-modal h3 { margin-bottom: 20px; text-align: center; font-size: 1.5rem; }
        .profile-modal-content { max-width: 900px; padding: 0; max-height: 85vh; overflow-y: auto; }
        .profile-modal-header { padding: 30px; display: flex; flex-direction: column; align-items: center; text-align: center; }
        #profile-header-img { width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--accent-color); object-fit: cover; margin-bottom: 15px;}
        #profile-header-name { font-size: 1.8rem; }
        .profile-modal-body { padding: 25px 30px; }
        .profile-section-title { font-size: 1.3rem; border-bottom: 2px solid var(--accent-color); padding-bottom: 8px; margin-bottom: 20px; }
        .contact-info { display: flex; flex-wrap: wrap; gap: 25px; } .contact-info a { color: var(--secondary-text); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .contact-info i { font-size: 1.4rem; } 
        .location-item { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin-bottom: 15px; border-right: 3px solid var(--border-color); transition: border-color 0.3s; }
        .location-item:hover { border-right-color: var(--accent-color); }
        .location-item p { margin: 0 0 8px 0; line-height: 1.6; } .location-item p:last-child { margin-bottom: 0; }
        .location-item a { color: var(--accent-color); text-decoration: none; font-size: 0.9rem; font-weight: bold; }
        #map-container { min-height: 450px; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-logo">زانست<span>.</span></div>
        <div class="welcome-text">بخێر هاتن بۆ ڕێکا زانستی</div>
        <div class="loading-spinner"></div>
    </div>

    <header>
        <div class="container">
            <a href="#" onclick="switchNav(document.querySelector('#main-nav a'), 'manhaj-view')" class="logo">زانست<span>.</span></a>
            <nav id="main-nav">
                <a href="#" onclick="switchNav(this, 'manhaj-view')">ڕێکا زانستی</a>
                <a href="#" onclick="switchNav(this, 'waneyan-view')">وانەیێن گشتی</a>
                <a href="#" onclick="switchNav(this, 'pirtukxane-view')">پەرتوکخانە</a>
                <a href="#" onclick="switchNav(this, 'map-view')">خەریتا زانینێ</a>
            </nav>
            <div class="header-tools">
                <button id="search-icon-btn"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Views -->
        <div id="manhaj-view" class="view"></div>
        <div id="reading-view" class="view"></div>
        <div id="waneyan-view" class="view"></div>
        <div id="pirtukxane-view" class="view"></div>
        <div id="map-view" class="view"></div>
    </main>

    <!-- Search Overlay -->
    <div id="search-overlay">
        <span id="close-search-btn">&times;</span>
        <div class="search-modal-content">
            <input type="text" id="search-input-field" placeholder="ل ناڤێ پەرتوک، وانە، یان مامۆستایەکى بگەڕێ..." onkeyup="handleSearch(event)">
            <div id="search-results-container"></div>
        </div>
    </div>
    
    <!-- All Modals -->
    <div class="modal-overlay" id="lesson-list-modal">
        <div class="modal-content">
            <span class="close-modal-btn" onclick="closeModal('lesson-list-modal')">&times;</span>
            <h3 id="lesson-list-title"></h3>
            <div id="lesson-list-container"></div>
        </div>
    </div>
    <div class="modal-overlay" id="teacher-profile-modal">
        <div class="modal-content profile-modal-content">
            <span class="close-modal-btn" onclick="closeModal('teacher-profile-modal')">&times;</span>
            <div class="profile-modal-header"><img id="profile-header-img" src=""><h2 id="profile-header-name"></h2><p id="profile-header-bio"></p></div>
            <div class="profile-modal-body">
                <div id="contact-section"><h3 class="profile-section-title">پەیوەندی</h3><div id="contact-info-container" class="contact-info"></div></div>
                <div id="locations-section" style="margin-top: 30px;"><h3 class="profile-section-title">جهێن وانەگۆتنێ</h3><div id="profile-locations-container"></div></div>
                <div id="lessons-section" style="margin-top: 30px;"><h3 class="profile-section-title">وانە و زنجیرە</h3><div id="profile-lessons-container"></div></div>
            </div>
        </div>
    </div>

    <footer><p>&copy; ٢٠٢٤ - پرۆژێ زانست. هەمی ماف پاراستینە.</p></footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // === KODA GOHARTÎ JI BO KARKIRINA BI CMS'Ê RE ===

        // --- GLOBAL VARIABLES ---
        let allData = {}; // Em ê paşî ji data.json tije keyn
        let map = null, mapInitialized = false, teacherMarkers = {};

        // --- INIT & SETUP ---
        document.addEventListener('DOMContentLoaded', async function() {
            // Data'yê ji file'ê data.json بخوینە
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                allData = await response.json();
            } catch (error) {
                console.error('Kêşe di xwendina data.json da heye:', error);
                document.getElementById('loading-screen').innerHTML = '<h1 style="color:white;text-align:center;">کێشەیەک د بارکرنا زانیاریان دا هەیە.</h1>';
                return;
            }

            // Nuke berdewam be li ser karê mayî
            setTimeout(() => { document.getElementById('loading-screen').classList.add('fade-out'); }, 500);
            
            const searchBtn = document.getElementById('search-icon-btn');
            const searchOverlay = document.getElementById('search-overlay');
            const closeSearchBtn = document.getElementById('close-search-btn');
            searchBtn.addEventListener('click', () => searchOverlay.classList.add('active'));
            closeSearchBtn.addEventListener('click', () => searchOverlay.classList.remove('active'));
            searchOverlay.addEventListener('click', (e) => { if (e.target.id === 'search-overlay') searchOverlay.classList.remove('active'); });
            
            buildManhajView();
            switchNav(document.querySelector('#main-nav a'), 'manhaj-view');
        });
        
        // --- VIEW MANAGEMENT ---
        function showView(viewId) { document.querySelectorAll('.view').forEach(v => v.classList.remove('is-active')); const targetView = document.getElementById(viewId); if (targetView) targetView.classList.add('is-active'); window.scrollTo(0, 0); if (viewId === 'map-view' && map) setTimeout(() => map.invalidateSize(), 10); }
        function switchNav(element, viewId) { const targetView = document.getElementById(viewId); if (!targetView) return; if (!targetView.dataset.isBuilt) { if (viewId === 'waneyan-view') buildWaneyanView(); else if (viewId === 'pirtukxane-view') buildPirtukxaneView(); else if (viewId === 'map-view') buildMapView(); targetView.dataset.isBuilt = 'true'; } document.querySelectorAll('#main-nav a').forEach(a => a.classList.remove('active')); if(element) element.classList.add('active'); showView(viewId); if (viewId === 'map-view' && !mapInitialized) initializeMap(); }
        function openModal(modalId) { document.getElementById(modalId)?.classList.add('is-visible'); }
        function closeModal(modalId) { document.getElementById(modalId)?.classList.remove('is-visible'); }

        // --- VIEW BUILDERS ---
        function buildManhajView() { const container = document.getElementById('manhaj-view'); container.innerHTML = `<header class="page-header"><h1>ڕێکا زانستی</h1><p>قۆناغ ب قۆناغ دگەل مە بە</p></header><div id="manhaj-container"></div>`; const accordionContainer = container.querySelector('#manhaj-container'); allData.curriculum.levels.forEach(level => { const accordion = document.createElement('button'); accordion.className = 'accordion'; accordion.innerHTML = `${level.title} <span class="icon">›</span>`; const panel = document.createElement('div'); panel.className = 'panel'; level.items.forEach(itemId => { const item = allData.curriculum.items.find(i => i.matnId === itemId); if (item) panel.innerHTML += `<div class="item-card" onclick="buildReadingView('${itemId}')"><h4>${item.title}</h4></div>`; }); accordionContainer.appendChild(accordion); accordionContainer.appendChild(panel); accordion.addEventListener("click", function() { this.classList.toggle("active"); this.nextElementSibling.style.maxHeight = this.nextElementSibling.style.maxHeight ? null : this.nextElementSibling.scrollHeight + "px"; }); }); }
        function buildReadingView(matnId) { const item = allData.curriculum.items.find(i => i.matnId === matnId); if (!item) return; const container = document.getElementById('reading-view'); container.innerHTML = `<button class="back-btn" onclick="switchNav(document.querySelector('#main-nav a'), 'manhaj-view')">‹ ڤەگەڕە</button><div class="reading-layout"><div class="sharah-wrapper"><div class="sharah-header"><h2>شلۆڤەکرن: ${item.title}</h2></div><div class="teacher-tabs" id="teacher-tabs-container">${item.explanations.map((exp, index) => { const teacher = allData.teachers.find(t => t.id === exp.teacherId); return `<div class="teacher-tab ${index === 0 ? 'active' : ''}"><a href="#" onclick="event.preventDefault(); showExplanation(this, '${exp.id}', '${matnId}')">${teacher?.name || 'نەناسراو'}</a></div>`; }).join('')}</div><div id="explanation-content-wrapper"></div></div><div class="sharah-wrapper"><div class="sharah-header"><h2>مەتن: ${item.title}</h2></div><div id="matn-content-container">${item.text.map(p => `<p>${p}</p>`).join('')}</div></div></div>`; showView('reading-view'); if (item.explanations.length > 0) showExplanation(document.querySelector('.teacher-tab a'), item.explanations[0].id, matnId); }
        function showExplanation(element, explanationId, matnId) { const matn = allData.curriculum.items.find(i => i.matnId === matnId); const explanation = matn?.explanations.find(exp => exp.id === explanationId); if (!explanation) return; document.querySelectorAll('.teacher-tab').forEach(tab => tab.classList.remove('active')); element.closest('.teacher-tab').classList.add('active'); const wrapper = document.getElementById('explanation-content-wrapper'); let seriesButtonHTML = ''; if (explanation.seriesId && allData.generalLectures.find(l => l.id === explanation.seriesId)) { seriesButtonHTML = `<button class="card-btn-small" style="margin: 20px auto; display: block;" onclick="showLessonList('${explanation.seriesId}')">هەمی وانەیێن ڤێ زنجیرێ ببینە</button>`; } wrapper.innerHTML = `<div id="explanation-content">${explanation.videos.map(video => `<div class="lesson-item"><span>${video.title}</span><button class="watch-btn" onclick="window.open('${video.url}','_blank')">تەماشەکرن</button></div>`).join('')}</div>${seriesButtonHTML}`; }
        function buildWaneyanView() { const container = document.getElementById('waneyan-view'); container.innerHTML = `<header class="page-header"><h1>وانەیێن گشتی</h1><p>وانە و زنجیرەیێن جودا جودا</p></header><div class="filters-container" id="waneyan-filters"></div><div class="waneyan-grid" id="waneyan-grid"></div>`; const categories = ['all', ...new Set(allData.generalLectures.map(l => l.category))]; const teachers = ['all', ...allData.teachers.map(t => t.id)]; document.getElementById('waneyan-filters').innerHTML = `<div class="filter-group"><h4>بابەت:</h4>${categories.map(cat => `<button class="filter-btn ${cat === 'all' ? 'active' : ''}" data-filter-type="category" data-filter-value="${cat}">${cat === 'all' ? 'هەمووی' : cat}</button>`).join('')}</div><div class="filter-group"><h4>مامۆستا:</h4>${teachers.map(tId => { const teacher = allData.teachers.find(t => t.id === tId); return `<button class="filter-btn ${tId === 'all' ? 'active' : ''}" data-filter-type="teacher" data-filter-value="${tId}">${tId === 'all' ? 'هەمووی' : teacher?.name}</button>`}).join('')}</div>`; document.querySelectorAll('#waneyan-filters .filter-btn').forEach(btn => btn.addEventListener('click', function() { const { filterType } = this.dataset; document.querySelectorAll(`#waneyan-filters .filter-btn[data-filter-type="${filterType}"]`).forEach(b => b.classList.remove('active')); this.classList.add('active'); filterLectures(); })); filterLectures(); }
        function filterLectures() { const activeCategory = document.querySelector('#waneyan-filters .filter-btn[data-filter-type="category"].active').dataset.filterValue; const activeTeacherId = document.querySelector('#waneyan-filters .filter-btn[data-filter-type="teacher"].active').dataset.filterValue; const grid = document.getElementById('waneyan-grid'); const filteredLectures = allData.generalLectures.filter(l => (activeCategory === 'all' || l.category === activeCategory) && (activeTeacherId === 'all' || l.teacherId === activeTeacherId)); grid.innerHTML = filteredLectures.length ? filteredLectures.map(lecture => { const teacher = allData.teachers.find(t => t.id === lecture.teacherId); return `<div class="wana-card"><img src="${lecture.image}" class="wana-card-img"><div class="wana-card-content"><h3>${lecture.title}</h3><p><strong>مامۆستا:</strong> <a href="#" onclick="event.preventDefault(); showTeacherProfile('${lecture.teacherId}')">${teacher?.name || 'نەناسراو'}</a></p><p><strong>بابەت:</strong> ${lecture.category}</p><div class="card-btn-group"><button class="card-btn-small" onclick="showLessonList('${lecture.id}')">لیستی وانەکان</button><button class="card-btn-small secondary" onclick="showTeacherProfile('${lecture.teacherId}')">پرۆفایل</button></div></div></div>`; }).join('') : '<p style="text-align:center; grid-column: 1 / -1;">هیچ وانەیەک لسەر ڤان فیلتەران نەهاتە دیتن.</p>'; }
        function buildPirtukxaneView() { const container = document.getElementById('pirtukxane-view'); container.innerHTML = `<header class="page-header"><h1>پەرتوکخانە</h1><p>کۆمەڵێک پەرتوکی پێشنیارکراو</p></header><div class="pirtuk-grid" id="pirtuk-grid">${allData.pirtukxane.map(book => `<div class="pirtuk-card"><img src="${book.coverImage}" class="pirtuk-card-img"><div class="pirtuk-card-content"><h3>${book.title}</h3><p><strong>نووسەر:</strong> ${book.author}</p><p>${book.description}</p><div class="card-btn-group"><button class="card-btn-small" onclick="window.open('${book.readUrl}','_blank')">خواندن</button><button class="card-btn-small secondary" onclick="window.open('${book.downloadUrl}','_blank')">داگرتن</button></div></div></div>`).join('')}</div>`; }
        function buildMapView() { const container = document.getElementById('map-view'); container.innerHTML = `<header class="page-header"><h1>خەریتا زانینێ</h1><p>شوێنەکانی مامۆستایان</p></header><div id="teacher-stories-bar">${allData.teachers.map(t => `<div class="teacher-story"><div class="story-avatar-wrapper" onclick="showTeacherProfile('${t.id}')"><div class="story-avatar"><img src="${t.profileImage}"></div></div><a href="#" class="story-profile-link" onclick="event.preventDefault(); showTeacherProfile('${t.id}')">${t.name}</a></div>`).join('')}</div><div id="map-container"></div>`; }
        function initializeMap() { if (mapInitialized) return; map = L.map('map-container').setView([36.5, 43.0], 8); L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap contributors' }).addTo(map); allData.teachers.forEach(teacher => { teacher.locations.forEach((location, index) => { const markerId = `${teacher.id}_${index}`; const marker = L.marker(location.coordinates).addTo(map); marker.bindPopup(`<div style="text-align:center;font-family:var(--font-kurdish);"><img src="${teacher.profileImage}" style="width:50px;height:50px;border-radius:50%;margin-bottom:10px;"><h4 style="margin:0;font-size:1rem;">${teacher.name}</h4><p style="margin:5px 0;"><strong>${location.name}</strong></p><p style="margin:5px 0;font-size:0.9rem;"><strong>وانە:</strong> ${location.lessonTaught || 'نادیار'}</p><p style="margin:5px 0;font-size:0.9rem;"><strong>کەنگی:</strong> ${location.schedule}</p><button onclick="showTeacherProfile('${teacher.id}')" style="background:var(--accent-color);color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-family:var(--font-kurdish);">پرۆفایل</button></div>`); teacherMarkers[markerId] = marker; }); }); mapInitialized = true; }
        
        // --- HANDLERS & OTHER FUNCTIONS ---
        function handleSearch(event) { const query = event.target.value.toLowerCase().trim(); const resultsContainer = document.getElementById('search-results-container'); if (query.length < 2) { resultsContainer.innerHTML = ''; return; } let resultsHTML = ''; let count = 0; const clickAndClose = (onclickAction) => `onclick="${onclickAction}; document.getElementById('search-overlay').classList.remove('active');"`; allData.teachers.forEach(teacher => { if (teacher.name.toLowerCase().includes(query)) { resultsHTML += `<div class="search-result-item" ${clickAndClose(`showTeacherProfile('${teacher.id}')`)}> <img src="${teacher.profileImage}"><div><h4>${teacher.name}</h4><span class="item-type">مامۆستا</span></div></div>`; count++; }}); allData.generalLectures.forEach(l => { if (l.title.toLowerCase().includes(query)) { resultsHTML += `<div class="search-result-item" ${clickAndClose(`showLessonList('${l.id}')`)}> <img src="${l.image}"><div><h4>${l.title}</h4><span class="item-type">وانە</span></div></div>`; count++; }}); allData.pirtukxane.forEach(b => { if (b.title.toLowerCase().includes(query)) { resultsHTML += `<div class="search-result-item" ${clickAndClose(`switchNav(document.querySelector('#main-nav a[onclick*=\\'pirtukxane-view\\']'), 'pirtukxane-view')`)}> <img src="${b.coverImage}" style="border-radius:4px;"><div><h4>${b.title}</h4><span class="item-type">پەرتوک</span></div></div>`; count++; }}); if (count === 0) resultsHTML = '<p style="text-align: center; color: var(--secondary-text);">هیچ ئەنجامەک نەهاتە دیتن.</p>'; resultsContainer.innerHTML = resultsHTML; }
        function showLessonList(lectureId) { const lecture = allData.generalLectures.find(l => l.id === lectureId); if (!lecture) return; openModal('lesson-list-modal'); document.getElementById('lesson-list-title').textContent = lecture.title; document.getElementById('lesson-list-container').innerHTML = lecture.videos.map(video => `<div class="lesson-item clickable" onclick="window.open('${video.url}','_blank')"><span>${video.title}</span><button class="watch-btn">تەماشەکرن</button></div>`).join(''); }
        function showTeacherProfile(teacherId) { const teacher = allData.teachers.find(t => t.id === teacherId); if (!teacher) return; openModal('teacher-profile-modal'); document.getElementById('profile-header-img').src = teacher.profileImage; document.getElementById('profile-header-name').textContent = teacher.name; document.getElementById('profile-header-bio').textContent = teacher.bio; document.getElementById('contact-info-container').innerHTML = `<a href="tel:${teacher.phone}"><i class="fas fa-phone"></i> ${teacher.phone}</a> ${Object.entries(teacher.social).map(([p,u])=>`<a href="${u}" target="_blank"><i class="fab fa-${p.toLowerCase()}"></i> ${p}</a>`).join('')}`; document.getElementById('profile-locations-container').innerHTML = teacher.locations.map((loc, index) => { const markerId = `${teacher.id}_${index}`; return `<div class="location-item"><p><strong><i class="fas fa-map-marker-alt" style="margin-left: 8px; color: var(--accent-color);"></i>جهـ:</strong> ${loc.name}</p><p><strong><i class="fas fa-book-open" style="margin-left: 8px; color: var(--accent-color);"></i>وانا لێ دهێتە گۆتن:</strong> ${loc.lessonTaught || 'نەهاتیە دیارکرن'}</p><p><strong><i class="fas fa-clock" style="margin-left: 8px; color: var(--accent-color);"></i>کەنگی:</strong> ${loc.schedule}</p><a href="#" onclick="event.preventDefault();closeModal('teacher-profile-modal');switchNav(document.querySelector('#main-nav a[onclick*=\\'map-view\\']'),'map-view');setTimeout(()=>{map.setView([${loc.coordinates}],15); if(teacherMarkers['${markerId}']) teacherMarkers['${markerId}'].openPopup();},500);">لەسەر نەخشە ببینە</a></div>`}).join('') || '<p>هیچ جهەکێ وانەگۆتنێ بۆ ڤی مامۆستای نەهاتیە تۆمارکرن.</p>'; const lessonsContainer = document.getElementById('profile-lessons-container'); const teacherLectures = allData.generalLectures.filter(l => l.teacherId === teacherId); const teacherExplanations = []; allData.curriculum.items.forEach(item => { item.explanations.forEach(exp => { if (exp.teacherId === teacherId) teacherExplanations.push({title: item.title, matnId: item.matnId, explanation: exp}); }); }); lessonsContainer.innerHTML = `${teacherLectures.map(l => `<div class="lesson-item clickable" onclick="closeModal('teacher-profile-modal');showLessonList('${l.id}')"><span>${l.title}</span><button class="watch-btn">وانەکان</button></div>`).join('')}${teacherExplanations.map(i => `<div class="lesson-item clickable" onclick="closeModal('teacher-profile-modal');buildReadingView('${i.matnId}')"><span>شلۆڤەکرنی ${i.title}</span><button class="watch-btn">${i.explanation.videos.length} وانە</button></div>`).join('')}`; }
    </script>
</body>
</html>
